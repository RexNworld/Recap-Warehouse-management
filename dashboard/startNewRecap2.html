<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
  <title>Dashboard</title>
  <link rel="icon" type="image/jpeg" sizes="1500x1500" href="assets/img/banner/logo.png" />
  <link rel="icon" type="image/jpeg" sizes="1500x1500" href="assets/img/banner/logo.png" />

  <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" /> -->
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/style.css" />
  <!-- <link href="assets/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" /> -->
  <link rel="stylesheet" href="assets/fontawesome/css/all.min.css" />
  <script src="/assets/js/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <link href="assets/boxicons/css/boxicons.min.css" rel="stylesheet" />
</head>

<body id="page-top">
  <div id="wrapper">
    <nav class="navbar navbar-light align-items-start sidebar sidebar-white text-dark accordion p-0 gradient">
      <div class="container-fluid d-flex flex-column p-0">
        <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0 px-4" href="#"
          style="height: 100%; width: 100%">
          <div class="sidebar-brand-icon">
            <img src="assets/img/icons/recap-icon.svg" alt="" class="w-100" />
          </div>
        </a>
        <hr class="sidebar-divider my-0" />
        <ul class="navbar-nav text-light" id="accordionSidebar">
          <li class="nav-item align-items-center">
            <a class="nav-link" href="index.html"><i class="bx bxs-home"></i><span>Dashboard</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="notifications.html"><i class="bx bxs-bell"></i><span>Notifications</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="message.html"><i class="bx bxs-message-rounded-dots"></i><span>Message</span></a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="editProfile.html"><i class="bx bxs-user-circle"></i><span>Edit Profile</span></a>
          </li>

          <li class="nav-item">
            <a class="nav-link active" href="startNewRecap.html"><i class="bx bxs-news"></i><span>Start New
                Recap</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="recapHistory.html"><i class="fa fa-history" aria-hidden="true"></i> <span>Recap
                History</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="followUp.html"><i class="fa fa-hashtag"
                aria-hidden="true"></i><span>Follow-Up</span></a>
          </li>
          <li class="nav-item">
            <div class="my-2 align-items-center">
              <div class="form- form-switch ps-3">
                <label class="form-check-label" for="flexSwitchCheckChecked"><i class="bx bxs-alarm"></i><span>
                    Notification Settings</span></label>
                <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" style="float: right"
                  checked />
              </div>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contactUs.html"><i class="bx bxs-phone"></i><span>Contact us</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="feedback.html"><i class="bx bxs-message-alt-error"></i><span>Feedback</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><img src="assets/img/icons/whatsapp.svg" class="me-2" /><span>Connect to
                WhatsApp</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><img src="assets/img/icons/slack.svg" class="me-2" /><span>Connect to
                Slack</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Logout.html"><i class="bx bxs-log-out"></i><span>Log out</span></a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="d-flex flex-column" id="content-wrapper">
      <div id="content">
        <nav class="navbar navbar-light navbar-expand bg-light border-bottom mb-4 topbar static-top">
          <div class="container-fluid">
            <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button">
              <i class="fas fa-bars"></i>
            </button>
            <h4 class="text-dark fw-bold m-0">Start New Recap</h4>

            <ul class="navbar-nav flex-nowrap ms-auto" style="width: auto">
              <li class="nav-item dropdown no-arrow">
                <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><i
                    class="fas fa-search"></i></a>
                <div class="dropdown-menu dropdown-menu-end p-3 animated--grow-in" aria-labelledby="searchDropdown">
                  <form class="me-auto navbar-search w-100">
                    <div class="input-group">
                      <input class="bg-light form-control border-0 small" type="text" placeholder="Search for ..." />
                      <div class="input-group-append">
                        <button class="btn btn-primary py-0" type="button">
                          <i class="fas fa-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </li>
              <li class="nav-item dropdown no-arrow mx-1">
                <div class="nav-item dropdown no-arrow">
                  <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span
                      class="badge bg-danger badge-counter">3+</span><i class="fas fa-bell fa-fw"></i></a>
                  <div class="dropdown-menu dropdown-menu-end dropdown-list animated--grow-in">
                    <h6 class="dropdown-header">alerts center</h6>
                    <a class="dropdown-item d-flex align-items-center" href="#">
                      <div class="me-3">
                        <div class="bg-primary icon-circle">
                          <i class="fas fa-file-alt text-white"></i>
                        </div>
                      </div>
                      <div>
                        <span class="small text-gray-500">December 12, 2019</span>
                        <p>A new monthly report is ready to download!</p>
                      </div>
                    </a><a class="dropdown-item d-flex align-items-center" href="#">
                      <div class="me-3">
                        <div class="bg-success icon-circle">
                          <i class="fas fa-donate text-white"></i>
                        </div>
                      </div>
                      <div>
                        <span class="small text-gray-500">December 7, 2019</span>
                        <p>$290.29 has been deposited into your account!</p>
                      </div>
                    </a><a class="dropdown-item d-flex align-items-center" href="#">
                      <div class="me-3">
                        <div class="bg-warning icon-circle">
                          <i class="fas fa-exclamation-triangle text-white"></i>
                        </div>
                      </div>
                      <div>
                        <span class="small text-gray-500">December 2, 2019</span>
                        <p>
                          Spending Alert: We've noticed unusually high spending for your account.
                        </p>
                      </div>
                    </a><a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
                  </div>
                </div>
              </li>

              <!-- <div class="d-none d-sm-block topbar-divider"></div> -->
              <li class="nav-item dropdown no-arrow">
                <div class="nav-item dropdown no-arrow">
                  <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#">
                    <!-- <span class="d-none d-lg-inline me-2 text-gray-600 small">Admin</span> -->
                    <img class="border rounded-circle img-profile" src="assets/img/avatars/avatar1.jpeg" />
                  </a>
                  <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in">
                    <a class="dropdown-item" href="#"><i
                        class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Profile</a><a class="dropdown-item"
                      href="#"><i class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Settings</a><a
                      class="dropdown-item" href="#"><i
                        class="fas fa-list fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Activity
                      log</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#"><i
                        class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Logout</a>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </nav>
        <div class="container-fluid" id="bToggle" style="z-index: 2">
          <div class="row">
            <div class="card card-recap p-0">
              <div class="card-body p-4">
                <div class="diagram" id="source">
                  <div class="top-btn">
                    <button class="border-0 bg-light rounded p-2" onclick="markToggle()">
                      <img src="assets/img/icons/pin.svg" alt="" />
                    </button>
                    <button class="border-0 bg-light rounded ms-2 p-2" onclick="drawToggle()">
                      <img src="assets/img/icons/drawing-palat.svg" alt="" />
                    </button>
                  </div>
                  <div class="inner-diagram dragscroll">
                    <img id="blueprintImg" class="" src="assets/img/icons/recap-diagram.svg" alt="" />
                    <img id="blueprintConstImg" class="d-none" src="assets/img/icons/recap-diagram.svg" alt="" />
                  </div>
                  <div class="bottom-btn bg-light rounded">
                    <button onclick="zoomin()" class="border-0 border-bottom p-2">
                      <i class="bx bx-plus"></i>
                    </button>
                    <button onclick="zoomout()" class="border-0 p-2"><i class="bx bx-minus"></i></button>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-end">
              <a href="startNewRecap.html" class="btn btn-primary m-1 px-5 py-3 bg-theme">Previous</a><a
                href="startNewRecap3.html" class="btn btn-primary m-1 px-5 py-3 bg-theme">Continue</a>
            </div>
          </div>
        </div>
        <!-- Drawing Canvas -->
        <div class="container-fluid d-none" id="bCanvas">
          <div class="tools">
            <button class="control-btn" onclick="clear_canvas()">Reset</button>

            <div class="d-none d-flex" id="drawTools">
            <button class="control-btn" onclick="undo_last()">Undo</button>
              <div onclick="change_color(this)" class="color-palate" style="background-color: red"></div>
              <div onclick="change_color(this)" class="color-palate" style="background-color: blue"></div>
              <div onclick="change_color(this)" class="color-palate" style="background-color: green"></div>
              <div onclick="change_color(this)" class="color-palate" style="background-color: yellow"></div>
              <input type="color" class="color-picker" oninput="draw_color = this.value">
              <input type="range" min="1" max="25" class="pen-range" value="2" oninput="draw_width = this.value">
            </div>

            <div class="d-none d-flex w-75 align-items-center" id="markerTools">
            <!-- <button class="control-btn" onclick="undo_marker_last()">Undo</button> -->
              <input id="markerText" type="text" placeholder="Enter marker Text" class="form-control w-75">
              <span class="ps-2 text-danger fst-italic"><b id="errorMarker" class="d-none">Enter marker Text First</b></span>
            </div>
            <button class="control-btn float-end" onclick="onSave()">Save</button>
          </div>
          <canvas id="blueprint"></canvas>
        </div>
      </div>
      <footer class="bg-light sticky-footer">
        <div class="container my-auto">
          <div class="text-center my-auto copyright"><span>Copyright © RECAP 2022</span></div>
        </div>
      </footer>
    </div>
  </div>
  <script>
    
    let drawing = false;
    function drawToggle() {
      $('#bToggle').addClass('d-none');
      $('#bCanvas').removeClass('d-none');
      $('#drawTools').removeClass('d-none');
      $('#markerTools').addClass('d-none');
      drawing = true;
    }
    function markToggle() {
      $('#bToggle').addClass('d-none');
      $('#bCanvas').removeClass('d-none');
      $('#drawTools').addClass('d-none');
      $('#markerTools').removeClass('d-none');
      drawing = false;
    }
    
    const canvas = document.getElementById('blueprint')
    const myImg = document.getElementById('blueprintImg')
    const myConstImg = document.getElementById('blueprintConstImg')
    
    canvas.width = myImg.width;
    canvas.height = myImg.height;

    let ctx = canvas.getContext('2d');


    let grd = ctx.createRadialGradient(75,50,5,90,60,100);
    grd.addColorStop(0, "rgb(0, 145, 214)");
    grd.addColorStop(1, "rgb(0, 78, 124)");
    let start_background_color = 'rgb(0, 78, 124)';
    ctx.fillStyle = start_background_color;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(myImg, 0, 0,  canvas.width, canvas.height)

    let draw_color = 'black';
    let draw_width = '2';
    let is_drawing = false;
    
    let restore_array = [];
    let index = -1;

    function change_color(e) {
      draw_color = e.style.backgroundColor;
    }

    canvas.addEventListener("touchstart", start, false)
    canvas.addEventListener("touchmove", draw, false)
    canvas.addEventListener("mousedown", start, false)
    canvas.addEventListener("mousemove", draw, false)

    canvas.addEventListener("touchend", stop, false)
    canvas.addEventListener("mouseup", stop, false)
    canvas.addEventListener("mouseout", stop, false)


    function start(e) {
      is_drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop)
      e.preventDefault();
    }
    function draw(e) {
      if (is_drawing && drawing) {
        ctx.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop)
        ctx.strokeStyle = draw_color;
        ctx.lineWidth = draw_width;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();
      }
      e.preventDefault();

    }
    function stop(e) {
      if (is_drawing) {
        ctx.stroke();
        ctx.closePath();
        is_drawing = false;
      }
      e.preventDefault();
      if (e.type != 'mouseout' && drawing) {
        restore_array.push(ctx.getImageData(0, 0, canvas.width, canvas.height))
        index += 1;
      }
    }

    function clear_canvas() {
        Markers = new Array();
        ctx.fillStyle = start_background_color;
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(myConstImg, 0, 0,  canvas.width, canvas.height)
        restore_array = [];
        index = -1;
    }
    function undo_last() {
      if (index <= 0) {
        clear_canvas();
      } else {
        index -= 1;
        restore_array.pop()
        ctx.putImageData(restore_array[index], 0, 0)
      }
    }
    function undo_marker_last(){
      Markers.pop();
    }
    function onSave(){
      var imagedata = canvas.toDataURL("image/png");
      $("#blueprintImg").attr('src',imagedata)
      $('#bToggle').removeClass('d-none');
      $('#bCanvas').addClass('d-none');
    }
/*
Drawing end
*/
    let Marker = function () {
      this.Sprite = new Image();
      this.Sprite.src = "./assets/img/marker.png"
      this.Width = 30;
      this.Height = 40;
      this.XPos = 0;
      this.YPos = 0;
      this.text = '';
    }
    let Markers = new Array();

    var mouseClicked = function (mouse) {
      if(!drawing && $('#markerText').val() == ''){
        $('#errorMarker').removeClass('d-none');
      }
      else if(!drawing){
        var rect = canvas.getBoundingClientRect();
        var mouseXPos = (mouse.x - rect.left);
        var mouseYPos = (mouse.y - rect.top);
        // Move the marker when placed to a better location
        var marker = new Marker();
        marker.XPos = mouseXPos - (marker.Width / 2);
        marker.YPos = mouseYPos - marker.Height;
        marker.text = $('#markerText').val()
        Markers.push(marker);
        $('#errorMarker').addClass('d-none');
        main();
      }
  }
  
  canvas.addEventListener("mousedown", mouseClicked, false);

  
let firstLoad = function () {
  ctx.font = "15px Georgia";
  ctx.textAlign = "center";
}

firstLoad();
let myTimer = ''
let main = function () {
  myTimer = setInterval(drawMarker, (1000 / 60)); // Refresh 60 times a second
};

let drawMarker = function () {
  // Draw markers
  for (var i = 0; i < Markers.length; i++) {
      var tempMarker = Markers[i];
      // Draw marker
      ctx.drawImage(tempMarker.Sprite, tempMarker.XPos, tempMarker.YPos, tempMarker.Width, tempMarker.Height);

      // Marker text
      var markerText = tempMarker.text;

      // Draw a simple box so you can see the position
      var textMeasurements = ctx.measureText(markerText);
      ctx.fillStyle = "#666";
      ctx.globalAlpha = 0.7;
      ctx.fillRect(tempMarker.XPos - (textMeasurements.width / 2), tempMarker.YPos - 15, textMeasurements.width, 20);
      ctx.globalAlpha = 1;

      // Draw position above
      ctx.fillStyle = "#000";
      ctx.fillText(markerText, tempMarker.XPos, tempMarker.YPos);
  }
  clearInterval(myTimer);
};

//setInterval(main, (1000 / 60)); // Refresh 60 times a second


    function zoomin() {
      var currWidth = myImg.width;
      var currHeight = myImg.height;
      if (currWidth > 2000) return false;
      else {
        myImg.style.width = (currWidth + 100) + "px";
        myImg.style.height = (currHeight + 100) + "px";
      }
    }
    function zoomout() {
      var currWidth = myImg.width;
      var currHeight = myImg.height;
      if (currWidth == 500) return false;
      else {
        myImg.style.width = (currWidth - 100) + "px";
        myImg.style.height = (currHeight - 100) + "px";
      }
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
  <script src="https://unpkg.com/boxicons@2.1.2/dist/boxicons.js"></script>
  <script src="assets/js/script.min.js"></script>
  <script src="assets/js/dragscroll.js"></script>
</body>
</html>